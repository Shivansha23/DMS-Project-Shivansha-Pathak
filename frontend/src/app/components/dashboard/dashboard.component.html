<mat-toolbar color="primary" class="toolbar">
  <span class="toolbar-title">üìÅ Document Management System</span>
  <span class="spacer"></span>
  <span class="user-info">{{ currentUser?.name }} ({{ currentUser?.role }})</span>
  <button mat-icon-button [matMenuTriggerFor]="menu">
    <mat-icon>account_circle</mat-icon>
  </button>
  <mat-menu #menu="matMenu">
    <button mat-menu-item (click)="logout()">
      <mat-icon>exit_to_app</mat-icon>
      <span>Logout</span>
    </button>
  </mat-menu>
</mat-toolbar>

<div class="dashboard-container">
  <div class="filters-section">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Search documents</mat-label>
      <input matInput [formControl]="searchControl" placeholder="Search by title or filename">
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

    <mat-form-field appearance="outline" class="filter-field">
      <mat-label>Sort by</mat-label>
      <mat-select [formControl]="sortControl">
        <mat-option value="date">Date (Newest)</mat-option>
        <mat-option value="title">Title (A-Z)</mat-option>
        <mat-option value="size">Size (Largest)</mat-option>
      </mat-select>
    </mat-form-field>

    <button mat-raised-button color="accent" (click)="navigateToUpload()" 
            *ngIf="authService.hasRole(['admin', 'editor'])" class="upload-btn">
      <mat-icon>cloud_upload</mat-icon>
      Upload Document
    </button>
  </div>

  <div class="documents-grid" *ngIf="!loading">
    <mat-card *ngFor="let doc of filteredDocuments" class="document-card" (click)="viewDocument(doc._id)">
      <mat-card-header>
        <mat-icon mat-card-avatar class="file-icon">description</mat-icon>
        <mat-card-title>{{ doc.title }}</mat-card-title>
        <mat-card-subtitle>{{ doc.fileName }}</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <p class="description" *ngIf="doc.description">{{ doc.description }}</p>
        <div class="document-meta">
          <span class="meta-item">
            <mat-icon>person</mat-icon>
            {{ doc.uploadedBy?.name }}
          </span>
          <span class="meta-item">
            <mat-icon>storage</mat-icon>
            {{ formatFileSize(doc.fileSize) }}
          </span>
          <span class="meta-item">
            <mat-icon>access_time</mat-icon>
            {{ doc.createdAt | date:'short' }}
          </span>
        </div>
        <div class="tags" *ngIf="doc.tags.length > 0">
          <mat-chip *ngFor="let tag of doc.tags">{{ tag }}</mat-chip>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button mat-button color="primary">
          <mat-icon>visibility</mat-icon>
          View
        </button>
        <button mat-button color="warn" (click)="deleteDocument(doc._id, $event)" 
                *ngIf="canEdit(doc)">
          <mat-icon>delete</mat-icon>
          Delete
        </button>
      </mat-card-actions>
    </mat-card>

    <div *ngIf="filteredDocuments.length === 0" class="no-documents">
      <mat-icon>folder_open</mat-icon>
      <h2>No documents found</h2>
      <p>Try adjusting your search or upload a new document</p>
    </div>
  </div>

  <div class="loading-spinner" *ngIf="loading">
    <mat-spinner></mat-spinner>
    <p>Loading documents...</p>
  </div>
</div>
